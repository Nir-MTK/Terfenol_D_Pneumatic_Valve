%% Initializing Matlab
format compact
clear all
close all
clc
%% Raw Data assign
HH =1e3*[0.464409349
1.161022577
1.857635806
2.554249034
3.250863854
3.947477082
4.87629578
5.805114479
6.966138648
8.127161225
9.055979924
9.984797031
10.91361573
11.84243284
12.77125154
13.70007023
14.62888893
15.32550216
16.02211698
16.48652633
17.18313956
17.87975279
18.80857148
19.50518471
20.43400182
21.5950244
22.5238431
23.45266179
24.61368437
25.77470695
26.70352565
27.63234435
28.56116145
29.48998015
30.41879885
31.11541208
32.04423078
32.97304948
33.90186817
34.59848299
35.52730169
36.4561188
37.15273203
37.84934526
38.77816236
39.47477559
40.17139041
41.10020911
42.02902781
42.72564263
43.65446133
44.35107455
45.04768937
45.7443026
46.67311971
47.36973294
48.29855164
48.99516486
49.69177809
50.38839291
51.31721161
52.24603031
53.17484901
54.10366771
54.80028093
55.49689416
55.96130192
56.65791515
57.35452838
58.28334708
59.21216577
60.14098447
61.06980317
61.76641799
62.46303122
63.15964445
63.85625768
64.5528709
65.48168801
66.41050671
67.10712153
68.03594023
68.73255346
69.42916828
70.1257815
70.82239473
71.51900955
72.21562437
72.9122376
73.60885083
74.30546406
75.00207728
75.69869051
76.39530374
76.85971309
77.55632791
78.25294114
79.18175984
80.11057853
81.03939723
81.96821593
82.89703463
83.59364786
84.29026109
84.98687432
85.45128207
85.91569142
86.61230465
87.076714
87.77332882
88.70214752
89.39876075
90.09537557
90.79199039
91.48860361
91.95301296
92.64962619
93.34623942
94.04285265
94.73946588
95.4360791
96.13269392
96.82930715
97.52592038
98.2225352
98.91915002
99.61576325
100.0801726
100.7767874
101.2411968
101.93781
102.6344232
103.3310365
103.7954442
104.4920574
104.9564668
105.1886723
105.6530816
106.3496964
106.8141058
107.510719
108.2073322
108.9039471
109.3683564
110.0649696
110.7615829
111.4581961
112.1548093
112.8514225
113.3158319
113.7802412
114.2446506
114.7090599
115.1734693
115.8700825
116.3344919
117.0311067
117.495516
117.9599254
118.4243347
119.1209496
119.5853589
120.0497683
120.7463815
121.2107908
121.6751986
122.1396063
122.6040141
123.0684235
123.5328328
123.9972421
124.4616515
125.1582663
125.6226757
126.087085
126.5514944
127.0159037
127.2481076
127.7125169
128.1769263
128.6413356
129.105745
129.8023582
130.266766
130.7311737
131.1955831
131.6599924
132.1244018
132.5888111
133.0532205
133.5176298
133.9820392
134.2142447
134.678654
135.1430633
135.3752672
135.8396766
136.3040859
136.7684953
137.2329046
137.697314
138.1617233
138.3939272
138.6261327
138.8583381
139.3227475
139.5549514
140.0193607
140.2515646
140.7159724
140.9481762
141.4125856
141.8769949
142.3414043
142.8058136
143.270223
143.5024269
143.7346307
143.9668346
144.1990401
144.4312456
144.8956549
145.3600643
145.8244736
146.0566775
146.2888814
146.2888814
146.2888814
146.5210868
146.7532923
147.2177017
147.4499071
147.9143165
148.1465204
148.3787242
148.3787242
148.6109281
148.843132
149.0753359
149.3075397
149.5397436
150.004153
150.2363584
150.4685639
150.7007694
150.9329749
150.9329749
150.9329749
151.1651787
151.1651787
151.3973826
151.6295865
151.8617904
151.8617904
152.0939943
152.3261997
152.5584052
152.5584052
152.7906107
153.0228161
153.0228161
153.25502
153.4872255
153.4872255
153.7194294
153.7194294
153.4872255
153.7194294
153.9516332
153.9516332
154.1838371
154.416041
154.416041
154.6482465
154.6482465
154.6482465
154.6482465
154.6482465
154.6482465
154.8804519
155.1126574
155.3448629
155.5770684
155.3448629
155.3448629
155.3448629
155.3448629
155.3448629
155.5770684
155.3448629
155.3448629
155.3448629
155.3448629
155.3448629
155.3448629
155.3448629
155.1126574
154.8804519
154.6482465
154.6482465
154.416041
154.416041
154.416041
154.416041
154.416041
154.1838371
153.9516332
153.7194294
153.4872255
153.2550216
153.2550216
153.2550216
153.2550216
153.2550216
153.2550216
153.0228161
152.7906107
152.5584052
152.3261997
152.3261997
152.3261997
152.3261997
152.0939958
151.861792
151.3973826
151.1651787
150.9329749
150.7007694
150.4685639
150.2363584
150.004153
149.7719475
149.7719475
149.5397436
149.3075397
149.0753359
148.843132
148.6109281
148.3787242
148.1465204
147.9143165
147.6821126
147.4499087
147.2177032
146.9854978
146.7532923
146.288883
145.8244736
145.5922697
145.1278604
144.663451
144.4312456
143.9668362
143.7346307
143.5024269
143.270223
143.0380191
143.0380191
142.5736098
142.3414043
142.1091988
141.8769933
141.412584
140.9481762
140.4837685
140.0193607
139.554953
139.0905436
138.8583381
138.6261327
138.1617233
137.9295179
137.4651085
137.0006992
136.5362898
136.3040843
135.6074711
135.1430618
134.6786524
134.2142431
133.5176298
133.0532205
132.8210166
132.5888127
132.1244034
131.659994
131.4277886
130.9633792
130.266766
129.8023582
129.5701543
128.8735411
128.4091318
127.9447224
127.4803131
126.7836982
126.3192889
125.6226757
125.1582663
124.693857
124.2294476
123.7650383
123.3006289
122.8362196
122.1396063
121.4429931
120.7463799
120.2819705
119.5853573
119.120948
118.8887441
118.4243347
117.7277215
117.2633122
116.5666973
116.102288
115.4056748
114.7090599
114.2446506
113.7802412
113.0836264
112.6192171
112.1548093
111.6904
110.9937867
110.2971735
109.6005603
109.1361509
108.2073322
107.7429229
107.0463097
106.3496948
105.65308
105.1886707
104.4920574
103.7954442
103.3310365
102.6344232
101.93781
101.2411968
100.7767874
100.0801726
99.38355937
98.68694614
97.99033132
97.2937165
96.59710327
96.13269392
95.4360791
94.73946588
94.04285265
93.5784433
92.88183007
92.18521684
91.48860361
90.79199039
89.86317169
89.16655687
88.46994364
87.77332882
87.076714
86.38010077
85.68348754
84.98687432
84.29026109
83.36144398
82.66483075
81.73601205
81.03939723
80.34278401
79.64616919
78.94955437
78.25294114
77.55632791
76.85971309
76.16309986
75.23428275
74.53766953
73.60885083
72.68003372
71.98342049
71.51901114
70.82239632
70.1257831
69.42916828
68.73255346
67.80373476
66.87491606
66.17830124
65.24948413
64.32066703
63.39184833
62.6952351
61.76641799
61.06980317
60.37318835
59.67657512
58.74775643
58.05114161
57.35452838
56.42571127
55.49689257
54.80027934
53.87146224
52.94264354
52.24602872
51.54941549
50.62059679
49.92398197
49.22736874
48.53075552
47.60193682
46.90532359
46.20871036
45.27989166
44.35107296
43.42225426
42.49343557
41.33241299
40.63579976
39.70698106
39.01036783
38.08155073
37.61714138
36.68832268
35.75950557
35.06289234
34.36627752
33.20525495
32.50864172
31.8120269
30.8832082
30.18659497
29.48998015
28.56116145
27.63234435
26.70352565
25.77470695
24.84588984
23.91707114
22.98825244
22.29163922
21.36282052
20.43400182
19.73738859
19.04077536
18.11195666
17.41534344
16.71873021
15.78991151
15.09329669
14.39668346
13.46786476
12.77124994
12.07463672
11.37802349
10.68141026
9.984797031
9.288183803
8.591570575
7.894957346
7.198342527
6.733933177
5.805114479
5.108499659
4.179680961
3.250862262
2.089839684
1.161022577
0.23220547
0
];

SS = [
    38.7236
23.43796
12.02468
4.68758
0.61142
0
2.85332
8.55996
17.52754
30.57128
47.07978
66.4416
88.0453
111.07566
135.3289
162.23164
192.3953
226.83896
265.76642
308.56622
354.62696
403.74484
455.71602
509.72528
564.54978
617.3362
665.23122
705.78914
738.19472
762.85556
782.42118
799.7449
815.84578
831.33522
845.80564
858.64558
869.03982
878.82262
888.60544
898.99968
909.39392
919.38054
927.9405
935.2776
942.00328
948.93278
956.88132
965.03368
972.3708
979.09648
985.41454
991.325
997.64306
1004.57256
1011.29824
1017.2087
1022.3039
1026.9915
1031.8829
1037.58954
1043.70378
1049.61424
1054.91326
1059.80466
1064.28846
1068.97606
1074.07126
1079.37028
1084.26168
1088.33784
1092.2102
1096.28638
1100.77018
1105.45778
1110.3492
1114.833
1118.50156
1121.9663
1125.83868
1129.91484
1133.7872
1137.86336
1141.3281
1144.58902
1148.05378
1152.12996
1156.00234
1160.07852
1163.54328
1166.6004
1169.45372
1172.71464
1175.97558
1179.23652
1182.49746
1185.35078
1188.2041
1191.26122
1194.52214
1197.78308
1201.24782
1204.10114
1206.54684
1209.19636
1211.84586
1214.29156
1217.3487
1220.40584
1222.85154
1225.50106
1228.5582
1231.0039
1233.6534
1236.50672
1238.74862
1240.7867
1243.0286
1245.0667
1247.5124
1250.36572
1252.60762
1254.84952
1257.49902
1259.74092
1261.779
1264.4285
1266.8742
1268.50468
1270.54276
1272.37704
1274.00752
1276.2494
1279.10272
1281.14082
1283.1789
1285.42078
1287.05126
1288.68172
1290.9236
1292.75788
1294.38836
1296.22264
1297.85312
1299.27978
1301.52168
1303.55976
1305.39404
1307.2283
1308.85878
1310.28544
1312.11972
1313.95398
1315.38064
1317.0111
1318.43776
1319.66062
1321.2911
1323.3292
1324.95968
1326.79396
1328.42442
1329.64726
1331.07392
1332.70438
1333.92722
1335.35388
1336.98436
1338.0034
1339.22626
1341.06054
1342.4872
1343.71004
1345.3405
1346.56334
1347.37858
1348.80524
1350.0281
1351.25096
1352.67762
1353.90046
1354.7157
1356.34616
1357.77282
1358.99568
1360.42234
1361.849
1362.46044
1363.27568
1364.29472
1365.31378
1366.33282
1367.75948
1368.5747
1369.59374
1370.81658
1372.03944
1373.05848
1374.28134
1375.30038
1375.9118
1376.72702
1377.54226
1378.5613
1379.58036
1380.80322
1381.61846
1382.43368
1383.45272
1384.06414
1384.87938
1385.69462
1386.30606
1386.71368
1387.73272
1388.54794
1389.36316
1390.3822
1391.40124
1391.80886
1392.4203
1393.03174
1393.64316
1394.2546
1395.06984
1395.47746
1396.08888
1396.7003
1397.31172
1397.92314
1398.94218
1399.5536
1400.16504
1400.77646
1401.38788
1401.7955
1402.40694
1402.81456
1403.22218
1403.8336
1404.2412
1404.85262
1405.66784
1406.07546
1406.27928
1406.6869
1407.09452
1407.29834
1407.70596
1408.11358
1408.3174
1408.5212
1408.92882
1409.33644
1410.15166
1410.76308
1411.1707
1411.3745
1411.7821
1411.7821
1411.9859
1412.39352
1412.59732
1412.80114
1413.41258
1413.6164
1413.8202
1414.43164
1414.63544
1414.43162
1414.63542
1414.63542
1414.4316
1414.63542
1414.83924
1415.04306
1415.45068
1415.8583
1416.0621
1416.2659
1416.4697
1416.4697
1416.2659
1416.2659
1416.2659
1416.2659
1416.46972
1416.87734
1417.08116
1417.28498
1417.4888
1417.28498
1417.28498
1417.28498
1417.08116
1416.87734
1416.87734
1416.67352
1416.4697
1416.67352
1416.67352
1416.67352
1416.87734
1416.67354
1416.26592
1416.06212
1415.85832
1415.4507
1415.24688
1415.24688
1415.24688
1415.04306
1414.83924
1414.63544
1414.22782
1413.8202
1413.6164
1413.4126
1413.20878
1412.80116
1412.39354
1411.98592
1411.5783
1411.3745
1411.3745
1411.1707
1410.9669
1410.7631
1410.35548
1409.74406
1409.33644
1408.725
1408.31738
1407.90976
1407.70594
1407.29832
1407.09452
1406.6869
1406.07548
1405.66786
1405.26024
1404.64882
1404.0374
1403.62978
1402.81456
1402.20314
1401.5917
1400.98026
1400.57264
1400.36882
1399.55358
1398.94216
1398.33074
1397.51552
1396.49648
1396.08886
1395.47744
1394.4584
1393.84696
1393.23554
1392.4203
1391.80886
1391.40124
1390.3822
1389.56696
1388.75174
1387.5289
1386.50986
1385.89844
1384.8794
1384.06416
1383.45274
1382.84132
1381.82228
1381.21086
1380.19182
1379.17276
1378.1537
1377.13466
1375.708
1374.68896
1373.66992
1372.44708
1371.63184
1371.0204
1370.00136
1369.18614
1368.3709
1366.94424
1365.51758
1364.49852
1363.07184
1361.64518
1360.82994
1359.8109
1358.58806
1357.56902
1356.54998
1355.12332
1353.90048
1352.47382
1350.84336
1349.4167
1348.19384
1346.76718
1345.54432
1344.52528
1343.09862
1341.67196
1340.4491
1339.02244
1337.39196
1336.1691
1334.53864
1332.70436
1331.2777
1329.85104
1328.22058
1326.99772
1325.77488
1323.9406
1322.51394
1320.88346
1319.0492
1317.41872
1315.99206
1313.95398
1312.11972
1310.48924
1308.65496
1306.82068
1305.39402
1303.55974
1301.52166
1299.68738
1297.85312
1295.81504
1293.98076
1292.14648
1290.1084
1288.27412
1286.43984
1284.40176
1282.56748
1280.5294
1278.2875
1276.24942
1274.21132
1271.76562
1269.72754
1267.68946
1265.24374
1262.79804
1260.75996
1258.51806
1256.07236
1254.03428
1251.9962
1249.5505
1247.1048
1244.65908
1242.00958
1239.36006
1236.71054
1233.85722
1231.20772
1228.762
1226.1125
1223.6668
1221.22108
1218.57156
1215.51444
1212.86492
1209.80778
1206.75066
1203.89734
1201.04402
1197.9869
1195.3374
1192.48408
1189.22314
1186.166
1183.10886
1179.4403
1175.97556
1172.71462
1169.24988
1165.78514
1162.72802
1159.46708
1156.20616
1152.94522
1149.27666
1145.40428
1141.73572
1137.65954
1133.58338
1129.71102
1125.83866
1121.7625
1117.89014
1113.81396
1109.53398
1105.45782
1101.17782
1096.69402
1092.21024
1087.72644
1082.83502
1078.14744
1073.45984
1068.36462
1063.47322
1058.78562
1053.6904
1048.5952
1043.7038
1038.20098
1032.49434
1026.7877
1020.87724
1014.96678
1009.05632
1002.94208
996.82782
990.91738
984.3955
977.87362
971.14792
964.21842
956.8813
949.5442
941.79948
933.85096
925.90244
917.5463
908.98634
900.42638
891.6626
882.08358
872.30076
862.11032
851.30846
839.89518
828.07428
815.43814
801.98678
787.72018
772.23072
755.51842
737.78708
718.01764
696.21012
672.16072
645.258
614.68672
580.8545
542.9461
500.96152
455.30838
407.00574
356.66502
306.3243
257.20644
210.9419
168.5497
131.45654
99.4586
72.55586
50.54452
32.81318
19.158
9.7828
4.27996
2.44568
4.48376
9.78278
18.13892
30.97886
47.48736
67.2568
89.67574
113.92898
139.40506
167.32684
198.71336
234.37988
274.73398
319.57188
368.28214
419.84572
474.0588
529.90234
585.74588
638.5323
685.20446
723.52048
753.68416
776.30692
794.44588
810.95438
827.25906
842.74852
856.81132
868.83604
878.82266
888.19786
897.98066
908.3749
918.97294
928.95956
937.1119
944.0414
950.97088
958.308
966.25654
974.40888
981.74598
987.86024
993.56688
999.27352
1005.7954
1012.9287
1019.8582
1025.76864
1030.86386
1035.75526
1040.85048
1046.55712
1052.67138
1058.37802
1063.26942
1067.75322
1072.237
1077.1284
1082.63122
1087.72644
1092.21022
1096.08258
1099.75114
1103.4197
1108.31112
1113.40634
1118.29776
1122.57774
1126.4501
1129.50722
1133.17578
1137.45576
1141.53194
1145.4043
1148.86904
1151.92616
1154.98328
1158.65182
1162.5242
1166.39656
1170.06512
1173.12226
1175.97558
1179.2365
1182.70126
1185.75838
1188.8155
1191.66882
1194.11454
1196.96786
1200.4326
1204.10116
1207.3621
1210.21542
1212.4573
1214.6992
1217.1449
1219.79442
1222.85154
1225.70488
1227.94678
1230.18868
1232.83818
1235.4877
1238.34102
1241.39814
1243.84384
1245.67812
1247.7162
1249.95808
1252.19998
1254.64568
1257.09138
1259.12946
1261.16756
1263.40946
1265.85516
1268.50468
1270.95038
1272.78464
1274.61892
1276.4532
1278.08366
1280.12176
1282.36366
1284.19794
1285.8284
1287.8665
1289.49696
1291.53504
1293.77692
1295.6112
1297.03786
1298.66834
1300.29882
1301.72548
1303.76358
1305.80166
1307.43212
1308.85878
1310.48926
1311.91592
1313.54638
1315.58446
1317.21492
1318.64158
1320.06824
1321.2911
1322.71776
1324.55204
1326.1825
1327.60916
1329.23962
1330.46248
1331.68534
1333.31582
1334.74248
1335.76154
1336.98438
1338.00342
1339.02246
1340.65292
1342.48718
1343.71004
1345.1367
1346.35954
1347.17478
1348.19384
1349.6205
1350.63954
1351.65858
1352.67762
1353.69666
1354.7157
1356.14236
1357.36522
1358.38426
1359.4033
1360.21854
1360.82996
1361.849
1362.86804
1363.68328
1364.70232
1365.72138
1366.74042
1367.96328
1369.18612
1370.20516
1371.2242
1371.83564
1372.44706
1372.85468
1373.66992
1374.28134
1375.09656
1376.1156
1377.13464
1377.94988
1378.96892
1379.78416
1380.19178
1380.80322
1381.21084
1381.41466
1382.02608
1382.84132
1383.45274
1384.26796
1385.08318
1385.69462
1386.30604
1386.91746
1387.5289
1387.93652
1388.54794
1388.75176
1389.15938
1389.36318
1389.9746
1390.1784
1390.99362
1391.40124
1392.01266
1392.6241
1393.23554
1393.43936
1393.84698
1394.2546
1394.05078
1394.25458
1394.6622
1395.06982
1395.47744
1396.29268
1396.7003
1396.9041
1397.1079
1397.1079
1397.1079
1397.3117
1397.3117
1397.3117
1397.92312
1398.33074
1398.53456
1399.14598
1399.5536
1399.3498
1399.5536
1399.5536
1399.3498
1399.5536
1399.7574
1399.7574
1399.9612
1400.36882
1400.36882
1400.57264
1400.77646
1400.98028
1400.98028
1401.1841
1400.98028
1400.77646
1400.77646
1400.77646
1400.57264
1400.77646
1400.98028
1400.77646
1400.77646
1400.98028
1400.57266
1400.36884
1400.16504
1399.75742
1399.5536
1399.7574
1399.5536
1399.5536
1399.7574
1399.34978
1398.94216
1398.94216
1398.73834
1398.12692
1397.92312
1397.71932
1397.3117
1397.1079
1397.1079
1397.1079
1397.1079
1397.1079
1396.9041
1396.7003
1396.29268
1395.68126
1395.27364
1394.86602
1394.4584
1394.2546
1394.2546
1394.0508
1393.84698
1393.64316
1393.43934
1392.8279
1392.42028
1392.01266
1391.40124
1390.99362
1390.58602
1389.77078
1389.36318
1389.15938
1388.54796
1388.34414
1388.34414
1387.5289
1386.71366
1386.10224
1385.287
1384.47176
1384.26794
1383.86032
1383.04508
1382.63748
1382.02606
1381.21084
1380.3956
1379.98798
1379.17274
1378.56132
1377.74608
1377.13466
1376.52324
1375.91182
1374.89278
1374.28136
1373.66994
1372.6509
1371.83566
1371.22422
1370.20518
1368.98232
1368.16708
1367.14804
1366.129
1365.51756
1364.90614
1363.8871
1363.27566
1362.46042
1361.44138
1360.42234
1359.6071
1358.18044
1356.9576
1355.93856
1354.9195
1353.90046
1353.28904
1352.4738
1351.45476
1350.43572
1349.21286
1347.99
1346.97096
1345.7481
1344.32144
1343.3024
1342.07956
1340.6529
1339.63386
1338.81864
1337.5958
1336.37294
1335.3539
1333.92724
1332.50058
1331.27772
1329.85106
1328.4244
1327.20154
1325.77488
1324.34822
1323.32918
1321.90252
1320.47586
1319.0492
1317.62254
1315.78826
1314.3616
1312.73114
1311.10066
1309.674
1308.04354
1306.41306
1305.1902
1303.76354
1301.92926
1300.5026
1299.07594
1297.03786
1295.4074
1293.77694
1291.94266
1290.1084
1288.68174
1286.84746
1285.21698
1283.58652
1281.75224
1279.71416
1277.87988
1275.8418
1273.8037
1271.96942
1269.93134
1267.89326
1266.05898
1264.2247
1261.9828
1260.14852
1258.31424
1256.27616
1254.23808
1252.4038
1249.9581
1247.5124
1245.0667
1242.621
1240.1753
1238.1372
1236.0991
1233.6534
1231.4115
1228.9658
1226.3163
1223.8706
1221.6287
1218.9792
1216.32968
1214.08778
1211.43828
1208.99258
1206.54686
1204.10116
1201.45164
1198.59832
1195.33738
1192.28026
1189.42694
1186.36982
1183.5165
1181.0708
1178.21748
1175.16036
1172.30704
1169.2499
1165.98896
1162.93184
1159.46708
1155.79852
1152.33378
1148.86904
1145.40428
1142.14336
1138.88242
1135.62148
1132.15672
1128.48818
1124.81962
1121.15108
1117.0749
1112.79492
1108.71874
1104.84638
1100.7702
1096.89784
1093.22928
1088.9493
1084.87312
1080.38932
1075.90554
1071.21796
1066.93798
1061.84276
1056.95136
1052.05994
1047.16852
1042.27712
1037.58952
1032.69812
1027.3991
1022.10008
1016.39344
1010.483
1004.77636
999.06972
992.95546
987.045
981.33836
975.02028
968.70222
962.38416
955.65848
948.32136
941.18806
933.64714
926.10622
918.3615
910.61678
902.46444
894.3121
885.75214
876.78456
867.61318
858.03418
847.84374
837.2457
826.24002
814.41912
802.1906
789.75828
776.3069
762.24412
747.7737
732.28426
715.57196
698.04442
679.09022
658.50556
636.90184
613.66766
588.80302
562.71552
535.40516
506.26054
476.7083
447.15606
417.1962
387.84778
359.72218
332.20802
305.7129
281.25586
258.22548
237.2332
218.4828
201.56668
186.28104
172.82968
160.39736
149.18788
139.20126
130.23368
121.87752
114.74422
108.22236
102.31192
97.0129
92.52912
70.31398
49.11788
28.94082
9.579
];
max_ppm = 1010; %[ppm] - max required Strain value

%UNCOMMENT NEXT LINE FOR MAXIMUM DATA PMM 
%max_ppm = max(SS+1)

% Creating S-H data for required Strain value
j=1;
for i=1:length(HH)
    if SS(i)<1010
    S(j) =SS(i);
    H(j)=HH(i);
    j=j+1;
    end
end
polyopt(H,S,2,6,0);
close all
%% 
figure('Name','HS DATA')
plot(H,S); %Plotting raw data
hold 'on'
hspoly = polyfit(H,S,4); %Polynomial fit: Strain(Magnetic field)
hbase = linspace(0,max(H),length(H)); % X axis 
hsval = polyval(hspoly,hbase); %Y axis
plot(hbase,hsval); % ploting polynomial fitting: Strain as function of Magnetic fiels intensity
grid 'on'
ylabel('Strain [ppm]')
xlabel('Magnetic Field [kA/m]')
title('Terfenol-D Strain Modeling')
%% Raw Data Plotting
figure('Name','SH DATA')
plot(S,H)
hold 'on'
grid 'on'
xlabel('Strain [ppm]')
ylabel('Magnetic Field [kA/m]')
title('Required Magetic Field for Specified Strain')

%% Polynomial Modeling of Raw Data
shpoly = polyfit(S,H,3);
sbase = linspace(0,max(S));
shval = polyval(shpoly,sbase);
plot(sbase,shval);
%% Raw Data vs. Polynomial Data

for i = 1:length(H)
    dif_s(i) = S(i)-polyval(hspoly,H(i));
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% FEMM Simulation
CircName = 'Coil';
save_fig = 0; % set as 1 to save FEMM simulation bitmap. Else: define as 0.
casename ='TerfenolD Plunger 01';
if(save_fig)
fig_dir = [casename '_Analysis figs__' datestr(now,'mmmm dd, yyyy HH;MM;SS')];
mkdir (fig_dir); %Create a new sub-folder for simulation figs
end
i_vec = 0:1:10;
n_coil = 24000; %Number of coil turns
z = linspace(-50,50,length(i_vec));
%axis_data = zeros(length(i_vec),14);
%% Open existing problem
openfemm;

opendocument('H:\Terfenol_D_Pneumatic_Valve\FEMM\Terfenol_Solenoid_2.FEM') %load FEMM problem
for i = 1:length(i_vec)
mi_selectlabel(35,-12);
mi_setblockprop('12 AWG', 1,0,'Coil', 0, 0, n_coil);
mi_setcurrent(CircName,i_vec(i)) %Set the current to 0
close all
mi_analyze(1)

mi_loadsolution
mo_selectblock(12,1)
if(save_fig)
    mo_savebitmap([ fig_dir '\' num2str(i_vec(i)) '.bmp']);
end
AJ_sol(i) = mo_blockintegral(0); 
A_sol(i) = mo_blockintegral(1);
MFE_sol(i) =  mo_blockintegral(2);
HL_sol(i) =  mo_blockintegral(3);
RL_sol(i) =  mo_blockintegral(4);
Bcsa_sol(i) =  mo_blockintegral(5);
Tl_sol(i) =  mo_blockintegral(6);
Tc_sol(i) =  mo_blockintegral(7);
IoBr_sol(i) =  mo_blockintegral(8);
IoBz_sol(i) =  mo_blockintegral(9);
Bv_sol(i) =  mo_blockintegral(10);
r_SS_LorentzForce_sol(i) =  mo_blockintegral(11);
z_SS_LorentzForce_sol(i) =  mo_blockintegral(12);
r_2x_LorentzForce_sol(i) =  mo_blockintegral(13);
z_2x_LorentzForce_sol(i) =  mo_blockintegral(14);
SS_Lorents_torque_sol(i) =  mo_blockintegral(15);
Lorentz_torque_x2_component_sol(i) =  mo_blockintegral(16);
Magnetic_field_coenergy_sol(i) =  mo_blockintegral(17);
r_SS_weighted_stress_tensor_force_sol(i) =  mo_blockintegral(18);
z_SS_weighted_stress_tensor_force_sol(i) =  mo_blockintegral(19);
r_2x_weighted_stress_tensor_force_sol(i) =  mo_blockintegral(20);
r_2x_weighted_stress_tensor_force_sol(i) =  mo_blockintegral(21);
SS_weighted_stress_tensor_torque_sol(i) =  mo_blockintegral(22);
two_component_of_weighted_stress_tensor_torque_sol(i) =  mo_blockintegral(23);
R2_sol(i) =  mo_blockintegral(24); %Moment of inertia/density

%% line
mo_clearblock
mo_addcontour(10,50);
mo_addcontour(10,-50);
axis_data(i,:) = abs(mo_lineintegral(1));

mo_clearcontour
mo_addcontour(30,-50);
mo_addcontour(30,50);
axis_data2(i,:) = abs(mo_lineintegral(1));


end
%closefemm

%% Create I-H Polynome
%% ===================
%% RAW DATA
Hn = axis_data(:,2);
Hn=Hn';
figure(1)
plot(i_vec,Hn)
grid on
xlabel('Current [A]')
ylabel('Magnetic Field Intensity [T]')
hold on

% I-H Polynom orser optimization
polyopt(i_vec,Hn,2,10,1);
%% I-H polynom
ihpoly = polyfit(i_vec,Hn,4);
ihpolyval = polyval(ihpoly,i_vec);
figure(1)
plot(i_vec,ihpolyval);
hold off
%% I-S Polynomial fitting

for i=1:length(i_vec)
    h = polyval(ihpoly,i_vec(i));
    td_is(i) = polyval(hspoly,h);
end
% close all
plot(i_vec,td_is);
title('Terfenol-D Plunger Simulation')
grid on
xlabel('Current [A]')
ylabel('Plunger Strain [ppm]')
%hold on
% %%
%  %Current required to specifiead H value:
% hipoly = polyfit(Hn,i_vec,4);
% req_i = polyval(hipoly,H); %Calculate the required current for factory data H values
% figure()
% plot(req_i,H) %Visualising the current requires to get the factory data H values
% ylabel('Current [A]')
% xlabel('Magnetic Field [A/m]')
% hold on
%% Interpulation
comp_h = polyval(ihpoly,i_vec); %Calculate the magnetic field created by i_vec
figure()
plot(H,S);
hold on
plot(comp_h,td_is)
title('Raw Data Comperasion')
    